<!DOCTYPE html>
<html lang="en" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Prompt Engineering & Multimodal RAG — Team Playbook</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #020617; /* slate-950 */
            color: #94a3b8; /* slate-400 */
            background-image: radial-gradient(circle at top right, rgba(29, 78, 216, 0.3), transparent 40%),
                              radial-gradient(circle at bottom left, rgba(109, 40, 217, 0.2), transparent 50%);
        }
        .nav-link {
            @apply px-3 py-2 rounded-md text-sm font-medium text-slate-400 hover:text-white hover:bg-slate-800/60 transition-all duration-200;
        }
        .nav-link.active {
            @apply bg-blue-600/20 text-blue-300 font-semibold;
        }
        .section-title {
            @apply text-3xl font-extrabold tracking-tight text-white sm:text-4xl;
        }
        .section-subtitle {
            @apply mt-3 text-lg leading-8 text-slate-400;
        }
        .card {
            @apply bg-slate-900/60 border border-slate-800/80 rounded-xl shadow-lg backdrop-blur-sm transition-all duration-300;
        }
        .prose { color: #94a3b8; }
        .prose h1, .prose h2, .prose h3, .prose h4, .prose h5, .prose h6 { color: white; }
        .prose strong { color: #e2e8f0; }
        .prose code {
            color: #f87171; /* red-400 */
            background-color: #1e293b; /* slate-800 */
            padding: 0.1em 0.3em;
            border-radius: 4px;
        }
        .prose pre {
            background-color: #0f172a; /* slate-900 */
            border: 1px solid #1e293b; /* slate-800 */
            padding: 1rem;
            border-radius: 0.5rem;
            color: #e2e8f0; /* slate-200 */
        }
        .prose ul > li::before { background-color: #64748b; }
        .checklist li {
            @apply flex items-start;
        }
        .checklist li::before {
            content: '✓';
            @apply mr-3 mt-1 flex-shrink-0 text-blue-400;
        }
        .diagram-node {
            @apply bg-slate-800 border border-slate-700 rounded-lg px-4 py-2 text-center text-white font-semibold shadow-md;
        }
        .diagram-arrow {
            @apply text-slate-600 font-mono text-2xl;
        }
    </style>
</head>
<body class="antialiased">

    <!-- Data Store -->
    <script id="playbook-data" type="application/json">
    {
        "purpose": {
            "why": "Give the team a clear, maintainable way to design prompts and Retrieval-Augmented Generation (RAG) for text and multimodal (images, slides, audio, video) use cases.",
            "who": "Executives (value & risk), product (requirements & scope), engineers/researchers (patterns & checklists), and operations (quality & monitoring).",
            "outcomes": [
                "Consistent prompt specs the whole org can read.",
                "Standard RAG designs that are adaptable to multimodal content.",
                "Shared language for evaluation, performance, safety, and governance."
            ]
        },
        "sitemap": [
            { "id": "home", "name": "Home" },
            { "id": "prompt_engineering", "name": "Prompt Engineering" },
            { "id": "rag_foundations", "name": "RAG Foundations" },
            { "id": "multimodal_rag", "name": "Multimodal RAG" },
            { "id": "agents_tools", "name": "Agents & Tools" },
            { "id": "evals_monitoring", "name": "Evals & Monitoring" },
            { "id": "performance_cost", "name": "Performance & Cost" },
            { "id": "safety_governance", "name": "Safety & Governance" },
            { "id": "patterns_cookbook", "name": "Patterns Cookbook" },
            { "id": "playgrounds", "name": "Playgrounds (Examples)" },
            { "id": "templates_checklists", "name": "Templates & Checklists" },
            { "id": "glossary_faq", "name": "Glossary & FAQ" },
            { "id": "use_case_analyst", "name": "Use Case: Earnings Analyst" }
        ],
        "home": {
            "diagram": {
                "id": "llm_system_anatomy",
                "nodes": [
                    {"id": "user", "label": "User"},
                    {"id": "prompt", "label": "Prompt (Task/Context/Rules)"},
                    {"id": "retrieval", "label": "Retrieval (Indexes & Filters)"},
                    {"id": "tools", "label": "Tools (Lookups/Calcs)"},
                    {"id": "guardrails", "label": "Guardrails (Safety/Policy)"},
                    {"id": "evals", "label": "Evals & Monitoring"},
                    {"id": "answer", "label": "Answer + Citations"}
                ],
                "edges": [
                    ["user","prompt"], ["prompt","retrieval"], ["prompt","tools"],
                    ["retrieval","prompt"], ["tools","prompt"], ["prompt","guardrails"],
                    ["guardrails","answer"], ["answer","evals"], ["evals","prompt"]
                ]
            },
            "pathways": {
                "exec": "Value, risks, KPIs, launch gates (1-page summary).",
                "eng": "Patterns, specs, and step-by-step checklists."
            }
        },
        "prompt_engineering": {
            "principles": [
                "**Clear task definition.** One sentence outcome.",
                "**Persona & guardrails.** Who is speaking; what must/ mustn’t happen.",
                "**Relevant context only.** Background, constraints, examples, scope limits.",
                "**Structured formats.** Lists, sections, or named fields.",
                "**Explicit output rules.** Structure, word/step limits, tone, and formatting."
            ],
            "spec_template": "Title:\nOwner:\nTask (one sentence):\nAudience & Persona:\nBackground/Context:\nConstraints/Assumptions:\nInputs:\nInstructions (ordered):\nOutput Format (fields & rules):\nExamples (2–3 pairs):\nSafety Rules (must/never):\nAcceptance Criteria (what “good” means):\nLinked Evals (golden sets / checks):\nVersion & Changelog:",
            "patterns": [
                {"name": "Constrained Bullets", "use": "exec summaries."},
                {"name": "Schema-like Output", "use": "consistent extraction."},
                {"name": "Critique-Then-Revise", "use": "self-review for quality."},
                {"name": "Chain-of-Checks", "use": "validations before final."},
                {"name": "Router Prompt", "use": "classify then hand off to a specialist prompt."}
            ],
            "anti_patterns": "Vague asks, hidden requirements, overlong context, “do-everything” prompts.",
            "prompt_ops": "Naming & ownership, change notes, test gates, versioning tied to product releases.",
            "example": {
                "vague": "Explain check-in at a luxury resort.",
                "optimized": "Explain check-in at a luxury resort as six numbered steps, ≤15 words per step, polite tone."
            }
        },
        "rag_foundations": {
            "diagram": {
                "id": "retrieval_pipeline",
                "nodes": [
                    {"id":"ingest","label":"Ingestion"},
                    {"id":"index","label":"Indexing"},
                    {"id":"retrieve","label":"Retrieval"},
                    {"id":"rerank","label":"Reranking"},
                    {"id":"generate","label":"Generation"},
                    {"id":"post","label":"Post-processing"},
                    {"id":"cite","label":"Citations"}
                ],
                "edges": [
                    ["ingest","index"],["index","retrieve"],["retrieve","rerank"],
                    ["rerank","generate"],["generate","post"],["post","cite"]
                ]
            },
            "choices": ["Chunking method", "hybrid vs single retrieval", "filters", "reranking", "citation style (page/slide/time)."],
            "ops": ["Freshness cadence", "privacy & compliance redaction", "provenance & poisoning defense."]
        },
        "multimodal_rag": {
            "ingestion": [
                {"modality": "Images & Charts", "steps": ["OCR", "concise captions", "keywords."]},
                {"modality": "Slides & PDFs", "steps": ["slide titles", "speaker notes", "figure captions", "tables summarized."]},
                {"modality": "Audio & Video", "steps": ["transcripts with timestamps", "optional speaker notes/chapters."]}
            ],
            "diagram": {
                "id":"multimodal_ingestion_map",
                "lanes":[
                    {"modality":"Images/Charts","steps":["OCR","Caption","Keywords","Store refs"]},
                    {"modality":"Slides/PDF","steps":["Titles","Notes","Figure captions","Table summaries"]},
                    {"modality":"Audio/Video","steps":["Transcript (timestamps)","Speakers","Scenes/Chapters"]}
                ],
                "mergeInto":"Searchable Knowledge"
            },
            "patterns": ["Text→Image", "Text→Video (time-coded)", "Image→Text (diagram similarity)."],
            "grounding": "Cite figure numbers/slide numbers/timestamps; evidence-first answers."
        },
        "evals_monitoring": {
            "offline": ["Golden sets", "rubrics for relevance/groundedness/exactness/tone/safety", "adversarial cases", "periodic human spot checks."],
            "online": ["Quality signals (edits, thumbs)", "operational signals (latency percentiles, retrieval hit rate, cache hit rate)", "business KPIs (resolution, deflection, satisfaction, cost/session).", "Controlled experiments."],
            "gates": ["Targets met on golden sets", "acceptable live behavior", "monitoring live", "rollback plan."],
            "golden_set_example": {
                "id":"finqa_017",
                "prompt":"Summarize Q2 performance and cite filings or slides.",
                "context_refs":["10-Q_2025_Q2#p5","Deck_Q2#s14","Earnings_Call#00:12:40-00:14:00"],
                "expected":{
                    "bullets":3,
                    "must_include":["revenue growth %","operating margin","guidance change"],
                    "must_cite":true
                },
                "severity":"high"
            },
            "rubric": [
                {"name": "Relevance", "def": "answer addresses the question directly; unrelated facts penalized."},
                {"name": "Groundedness", "def": "every claim traceable to cited sources; no speculative language."},
                {"name": "Exactness (extraction tasks)", "def": "numeric values and named fields match sources."},
                {"name": "Style", "def": "follows requested format, tone, and length."},
                {"name": "Safety", "def": "no sensitive data leakage; includes required disclaimers."}
            ]
        },
        "performance_cost": {
            "levers": ["Agree on an end-to-end latency budget", "cache reusable instructions and frequent queries", "keep context concise", "tune how many items to retrieve", "define freshness per source."],
            "budget": {
                "target_ms": 2000,
                "allocation": {
                    "retrieval": 500,
                    "reranking": 300,
                    "generation": 900,
                    "post_processing": 300
                },
                "degrade_strategy": ["skip_rerank","reduce_top_k","shorter_answer"]
            }
        },
        "patterns_cookbook": [
            {"name": "Grounded Q&A (Text)", "flow": "Retrieve → Rerank → Answer w/ citations → Validate.", "pitfalls": "Missing citations; hallucinated details."},
            {"name": "Chart Q&A (Image)", "flow": "Find chart → Brief description → Extract value/trend → Cite figure.", "pitfalls": "Misreading axes; low-quality OCR."},
            {"name": "Video “Moment Finder”", "flow": "Search transcript → Return timestamped snippet → 1-line context → Cite timecode.", "pitfalls": "Vague pointers; whole-transcript dumps."},
            {"name": "Structured Extraction", "flow": "Name fields and rules → Allow “unknown” → Validate.", "pitfalls": "Ambiguous field definitions."},
            {"name": "Decision + Tool", "flow": "Classify intent → If lookup/calc, perform → Return result + rationale.", "pitfalls": "Tool overuse; unclear fallbacks."},
            {"name": "Multi-hop QA", "flow": "Plan steps → Retrieve per step → Synthesize → Cite each source.", "pitfalls": "Missing a hop; shallow synthesis."}
        ],
        "templates_checklists": {
            "prompt_pr": ["One-sentence task", "Context & assumptions explicit", "Output rules & limits defined", "2–3 examples", "Safety rules embedded", "Golden cases pass threshold", "Version + owner updated"],
            "rag_pipeline": ["Chunking method justified", "Retrieval approach & filters chosen", "Rerank improves relevance without breaking latency goals", "Citations include page/slide/time", "Freshness cadence set", "Poisoning/injection tests pass"],
            "launch_gate": ["Offline targets met", "Live metrics acceptable (or justified trade)", "Monitoring active; alerts routed", "Rollback plan documented/tested"]
        },
        "glossary": {
            "Prompt": "The input given to an LLM, including instructions, context, and examples.",
            "Context": "Background information provided in a prompt to help the model generate a relevant answer.",
            "RAG": "Retrieval-Augmented Generation. A method to ground LLM answers by first retrieving relevant documents.",
            "Chunking": "The process of breaking down large documents into smaller, indexed pieces for retrieval.",
            "Reranking": "Re-ordering retrieved chunks to place the most relevant ones at the top before generation.",
            "Golden Set": "A curated, high-quality dataset of inputs and expected outputs used for regression testing.",
            "Groundedness": "A measure of whether the model's output is factually consistent with the provided source documents.",
            "Hallucination": "When an LLM generates factually incorrect or nonsensical information not based on its input data.",
            "Injection": "A security risk where malicious instructions are hidden in input data to hijack the prompt's intent."
        },
        "faq": [
            {"q": "Why not prompts alone?", "a": "Prompts alone rely on the model's internal, static knowledge, which can be outdated or wrong. RAG provides fresh, verifiable context."},
            {"q": "Why citations?", "a": "Citations build user trust, allow for fact-checking, and provide a path to deeper information."},
            {"q": "Do multimodal features slow things down?", "a": "They can, which is why we have latency budgets. We trade off complexity for value, and often, a chart is worth the extra processing time."},
            {"q": "When is it “production-ready”?", "a": "When it meets pre-defined quality gates on golden sets, shows acceptable performance on live traffic, and has a monitoring and rollback plan."},
            {"q": "Who owns prompts and pipelines?", "a": "Ownership is a partnership. Product defines the 'what,' Engineering builds the 'how,' and Ops ensures it runs reliably. Prompt specs have explicit owners."}
        ],
        "use_case_analyst": {
            "scenario": "Product managers and finance leads ask, “How did we perform this quarter compared to last?” They want a concise answer that references slides, filings, and specific timecodes from the earnings call video.",
            "sources": ["Quarterly deck (slides/titles/notes/figures).", "10-Q/10-K excerpts.", "Earnings call video with transcript and timestamps."],
            "output_rules": [
                "Exactly 5 bullets, each ≤18 words.",
                "Include: revenue growth %, operating margin, key driver, risk/concern, and guidance change.",
                "Cite at least two different sources, with slide numbers/pages/timecodes.",
                "If a field is unknown, say “Unknown (no source)”."
            ],
            "prompt_flow": [
                {
                    "title": "1) Query Normalizer (Router)", "goal": "Restate the user ask and list the facts required.",
                    "content": "You are a query normalizer.\nTask: Restate the user’s question concisely and list the required facts.\nInputs: user_question\nOutput:\n- restated_question (1 sentence)\n- required_facts (ordered list of fields to fill)\nRules:\n- Do not answer the question.\n- Keep it neutral and product-agnostic.",
                    "example": "• restated_question: “Summarize Q2 vs Q1 performance with growth, margins, drivers, risks, and guidance changes.”\n• required_facts: [revenue_growth_pct, operating_margin, key_driver, key_risk, guidance_change]"
                },
                {
                    "title": "2) Retrieval Query Builder", "goal": "Turn required facts into retrieval intents.",
                    "content": "You are a retrieval intent builder.\nTask: For each required_fact, propose 3 search intents with filters.\nInputs: restated_question, required_facts\nOutput per fact:\n- intents: [short queries targeting filings, slides, and transcript time windows]\nRules:\n- Use domain words likely present in corpora (e.g., “operating margin”, “guidance”).\n- Include a time window if quarter or date is implied.",
                    "example": "• operating_margin → [“operating margin Q2”, “margin trend slide”, “operating income percentage”]"
                },
                {
                    "title": "3) Evidence Assembler", "goal": "Collate top snippets for each fact (text + visual).",
                    "content": "You are an evidence assembler.\nTask: For each required_fact, list candidate snippets with source pointers.\nInputs: retrieved_snippets (from filings/slides/transcript)\nOutput per fact:\n- candidates: [{source_id, location (p#/s#/t=mm:ss), snippet_text_or_caption}]\nRules:\n- Prefer snippets that include explicit numbers or directives.\n- Keep 1–2 best candidates per fact.",
                    "example": null
                },
                {
                    "title": "4) Vision QA (for charts/figures)", "goal": "Read values or trends from a chart image.",
                    "content": "You are a chart explainer.\nTask: Given a chart image and the user’s restated question, extract the one value or trend needed.\nInputs: chart_image, restated_question\nOutput:\n- value_or_trend (short)\n- explanation (≤20 words)\n- citation_hint (figure title or slide number)\nRules:\n- State units and time period if visible.\n- If unreadable, say “Unknown (image unclear)”.",
                    "example": null
                },
                {
                    "title": "5) Synthesizer (Final answer)", "goal": "Produce the 5 bullets with citations.",
                    "content": "You are a financial results summarizer.\nTask: Write exactly 5 bullets (≤18 words each), covering:\n1) revenue growth %, 2) operating margin, 3) key driver, 4) key risk, 5) guidance change.\nInputs: restated_question, evidence_per_fact (text + chart findings)\nOutput:\n- bullets: [five concise bullets]\n- citations: map each bullet to at least one source pointer (page/slide/time)\nRules:\n- Use neutral tone, precise numbers, and cite at least two distinct sources overall.\n- If a required fact is missing, write “Unknown (no source)” and cite none.",
                    "example": null
                },
                {
                    "title": "6) Safety & Policy Check", "goal": "Ensure compliance before showing to users.",
                    "content": "You are a safety and policy checker.\nTask: Scan the bullets for sensitive or speculative statements.\nInputs: bullets, citations\nOutput:\n- status: \"ok\" or \"revise\"\n- notes: if \"revise\", specify which bullet and why\nRules:\n- No forward-looking claims unless they appear in guidance and are quoted.\n- No PII. Avoid speculative verbs (“might explode”).",
                    "example": null
                }
            ],
            "diagram": {
                "id":"earnings_flow",
                "nodes":[
                    {"id":"normalize","label":"Query Normalizer"},
                    {"id":"build_intents","label":"Retrieval Query Builder"},
                    {"id":"retrieve","label":"Retrieve Snippets"},
                    {"id":"evidence","label":"Evidence Assembler"},
                    {"id":"vision","label":"Vision QA (charts)"},
                    {"id":"synthesize","label":"Synthesizer"},
                    {"id":"safety","label":"Safety Check"},
                    {"id":"answer","label":"Answer + Citations"}
                ],
                "edges":[
                    ["normalize","build_intents"],["build_intents","retrieve"],
                    ["retrieve","evidence"],["evidence","vision"],
                    ["evidence","synthesize"],["vision","synthesize"],
                    ["synthesize","safety"],["safety","answer"]
                ]
            },
            "acceptance_criteria": [
                "Contains exactly 5 bullets, each ≤18 words.",
                "Includes revenue growth %, operating margin, a driver, a risk, and guidance.",
                "At least two different source types cited (e.g., slide + filing or slide + timecode).",
                "Numbers match sources; wording is neutral; no speculation."
            ]
        }
    }
    </script>

    <div class="flex min-h-screen">
        <!-- Sidebar Navigation -->
        <nav class="w-64 bg-slate-900/70 backdrop-blur-sm border-r border-slate-800 fixed top-0 left-0 h-full pt-8 z-20 overflow-y-auto">
            <div class="px-6">
                <h2 class="text-lg font-bold text-white">Prompt & RAG Playbook</h2>
                <p class="text-xs text-slate-400">Phase-1: Content-Only</p>
            </div>
            <div class="mt-8 space-y-1 px-4" id="navigation">
                <!-- Links will be injected by JS -->
            </div>
        </nav>

        <!-- Main Content -->
        <main class="flex-1 ml-64">
            <div id="page-content" class="p-8 lg:p-12 prose max-w-none">
                <!-- Page content will be injected by JS -->
            </div>
        </main>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const data = JSON.parse(document.getElementById('playbook-data').textContent);
            const navigation = document.getElementById('navigation');
            const pageContent = document.getElementById('page-content');

            function navigate(pageId) {
                window.location.hash = pageId;
                renderPage(pageId);
                window.scrollTo(0, 0);
            }

            function renderPage(pageId) {
                document.querySelectorAll('.nav-link').forEach(link => {
                    link.classList.toggle('active', link.getAttribute('href') === `#${pageId}`);
                });
                
                let html = '';
                switch (pageId) {
                    case 'home': html = renderHomePage(); break;
                    case 'prompt_engineering': html = renderPromptEngineeringPage(); break;
                    case 'rag_foundations': html = renderRagFoundationsPage(); break;
                    case 'multimodal_rag': html = renderMultimodalRagPage(); break;
                    case 'evals_monitoring': html = renderEvalsPage(); break;
                    case 'performance_cost': html = renderPerfCostPage(); break;
                    case 'patterns_cookbook': html = renderPatternsPage(); break;
                    case 'templates_checklists': html = renderTemplatesPage(); break;
                    case 'glossary_faq': html = renderGlossaryFaqPage(); break;
                    case 'use_case_analyst': html = renderUseCasePage(); break;
                    default: html = `
                        <h1 class="section-title">${data.sitemap.find(p => p.id === pageId)?.name || 'Page Not Found'}</h1>
                        <p class="section-subtitle">Content for this section is under construction.</p>
                    `;
                }
                pageContent.innerHTML = html;
            }

            function renderHomePage() {
                return `
                    <h1 class="section-title">Prompt Engineering & Multimodal RAG Playbook</h1>
                    <p class="section-subtitle">${data.purpose.why}</p>
                    <div class="mt-8 grid grid-cols-1 md:grid-cols-2 gap-8">
                        <div class="card p-6">
                            <h4>Who is this for?</h4>
                            <p>${data.purpose.who}</p>
                        </div>
                        <div class="card p-6">
                            <h4>Desired Outcomes</h4>
                            <ul class="list-disc list-inside">${data.purpose.outcomes.map(o => `<li>${o}</li>`).join('')}</ul>
                        </div>
                    </div>
                    
                    <h2 class="mt-16">LLM System Anatomy</h2>
                    <p>A modern LLM system is more than a prompt. It's a pipeline where prompts, retrieval, tools, and guardrails work together to produce high-quality, safe, and verifiable results.</p>
                    <div class="card mt-8 p-8">${renderDiagram(data.home.diagram, 'grid')}</div>

                    <h2 class="mt-16">Choose Your Path</h2>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-8 mt-6">
                        <div class="card p-6 border-l-4 border-blue-500">
                            <h4 class="text-blue-300">Executive Overview</h4>
                            <p>Focus on value, risks, KPIs, and the criteria for a successful launch. <a href="#" class="text-blue-400 hover:underline">Start here for the 1-page summary.</a></p>
                        </div>
                        <div class="card p-6 border-l-4 border-purple-500">
                            <h4 class="text-purple-300">Engineer Deep-Dive</h4>
                            <p>Explore technical patterns, prompt specifications, and step-by-step checklists for implementation. <a href="#prompt_engineering" class="text-purple-400 hover:underline">Jump to Prompt Engineering.</a></p>
                        </div>
                    </div>
                `;
            }

            function renderPromptEngineeringPage() {
                const d = data.prompt_engineering;
                return `
                    <h1 class="section-title">Prompt Engineering</h1>
                    <p class="section-subtitle">How we write prompts so they are clear, maintainable, and testable.</p>
                    
                    <h2 class="mt-12">Principles</h2>
                    <ul class="checklist">${d.principles.map(p => `<li>${marked.parseInline(p)}</li>`).join('')}</ul>

                    <h2 class="mt-12">Prompt Spec Template</h2>
                    <p>Use this template for every new prompt to ensure consistency and completeness. It serves as the source of truth for product, engineering, and QA.</p>
                    <div class="card mt-6">
                        <div class="bg-slate-800/50 px-4 py-2 border-b border-slate-800 text-sm text-slate-400 flex justify-between items-center">
                            <span>prompt_spec.md</span>
                            <button onclick="copyToClipboard(this)" data-copy-content="${d.spec_template.replace(/"/g, '&quot;')}" class="text-xs hover:text-white transition">Copy</button>
                        </div>
                        <pre class="m-0 p-4 rounded-t-none !bg-slate-900/80"><code>${d.spec_template}</code></pre>
                    </div>

                    <h2 class="mt-12">Common Patterns</h2>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mt-6">
                        ${d.patterns.map(p => `<div class="card p-4"><strong class="text-white">${p.name}</strong> &mdash; ${p.use}</div>`).join('')}
                    </div>

                    <h2 class="mt-12">Example: Vague vs. Optimized</h2>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mt-6">
                        <div class="card p-6 border-l-4 border-red-500">
                            <h4 class="text-red-400">Vague</h4>
                            <p class="italic">"${d.example.vague}"</p>
                            <p class="text-xs text-slate-500 mt-4">Fails because it lacks constraints on format, length, or tone, leading to unpredictable outputs.</p>
                        </div>
                        <div class="card p-6 border-l-4 border-green-500">
                            <h4 class="text-green-400">Optimized</h4>
                            <p class="italic">"${d.example.optimized}"</p>
                             <p class="text-xs text-slate-500 mt-4">Succeeds by providing explicit, testable instructions for structure, length, and style.</p>
                        </div>
                    </div>
                `;
            }

            function renderRagFoundationsPage() {
                const d = data.rag_foundations;
                return `
                    <h1 class="section-title">RAG Foundations</h1>
                    <p class="section-subtitle">Thinking about text-first retrieval in a way that's ready for multimodal content.</p>
                    
                    <h2 class="mt-12">Retrieval Pipeline Overview</h2>
                    <p>This is the standard flow for how we ingest information, search it, and use it to generate a grounded answer.</p>
                    <div class="card mt-8 p-8">${renderDiagram(d.diagram, 'flow')}</div>
                    
                    <div class="mt-12 grid grid-cols-1 md:grid-cols-2 gap-8">
                        <div class="card p-6">
                            <h3>Key Design Choices</h3>
                            <p>These must be made explicit for each RAG system.</p>
                            <ul class="list-disc list-inside mt-4">${d.choices.map(c => `<li>${c}</li>`).join('')}</ul>
                        </div>
                        <div class="card p-6">
                            <h3>Operational Considerations</h3>
                            <p>How we maintain quality and security over time.</p>
                            <ul class="list-disc list-inside mt-4">${d.ops.map(o => `<li>${o}</li>`).join('')}</ul>
                        </div>
                    </div>
                `;
            }
            
            function renderMultimodalRagPage() {
                const d = data.multimodal_rag;
                return `
                    <h1 class="section-title">Multimodal RAG</h1>
                    <p class="section-subtitle">Extending our RAG patterns to handle images, slides, audio, and video.</p>
                    
                    <h2 class="mt-12">Multimodal Ingestion Map</h2>
                    <p>Each modality requires a specialized ingestion process to extract searchable text and metadata.</p>
                    <div class="card mt-8 p-8">
                        <div class="space-y-6">
                        ${d.diagram.lanes.map(lane => `
                            <div>
                                <h4 class="font-semibold text-lg text-white">${lane.modality}</h4>
                                <div class="flex items-center gap-2 mt-2">
                                    ${lane.steps.map((step, i) => `
                                        <div class="diagram-node !px-3 !py-1 !text-sm flex-shrink-0">${step}</div>
                                        ${i < lane.steps.length - 1 ? `<div class="diagram-arrow">→</div>` : ''}
                                    `).join('')}
                                </div>
                            </div>
                        `).join('')}
                        </div>
                        <div class="text-center mt-8">
                            <div class="text-2xl text-slate-500">↓</div>
                            <div class="mt-2 inline-block diagram-node !bg-blue-600/30 !border-blue-500">${d.diagram.mergeInto}</div>
                        </div>
                    </div>
                `;
            }

            function renderEvalsPage() {
                const d = data.evals_monitoring;
                return `
                    <h1 class="section-title">Evals & Monitoring</h1>
                    <p class="section-subtitle">How we know our systems are working correctly, safely, and efficiently.</p>
                    
                    <h2 class="mt-12">Plain-English Judging Rubric</h2>
                    <div class="card mt-6 p-6 space-y-4">
                        ${d.rubric.map(r => `<div><strong class="text-white">${r.name}:</strong> ${r.def}</div>`).join('')}
                    </div>

                    <h2 class="mt-12">Golden Set Example</h2>
                    <p>A "golden" example from a test set, defining the expected output structure and content for a given prompt.</p>
                    <div class="card mt-6">
                        <div class="bg-slate-800/50 px-4 py-2 border-b border-slate-800 text-sm text-slate-400">finqa_017.json</div>
                        <pre class="m-0 p-4 rounded-t-none !bg-slate-900/80"><code>${JSON.stringify(d.golden_set_example, null, 2)}</code></pre>
                    </div>

                    <h2 class="mt-12">Gates for Production</h2>
                    <p>A release must meet these criteria before it can be deployed.</p>
                    <ul class="checklist mt-4">${d.gates.map(g => `<li>${g}</li>`).join('')}</ul>
                `;
            }
            
            function renderPerfCostPage() {
                const d = data.performance_cost;
                return `
                     <h1 class="section-title">Performance & Cost</h1>
                    <p class="section-subtitle">Managing latency and token usage with non-technical levers.</p>
                    
                    <h2 class="mt-12">Key Levers</h2>
                    <ul class="list-disc list-inside mt-4">${d.levers.map(l => `<li>${l}</li>`).join('')}</ul>

                    <h2 class="mt-12">Example Latency Budget</h2>
                    <p>We allocate a time budget to each step of the pipeline to identify and address bottlenecks.</p>
                    <div class="card p-6 mt-6">
                        <div class="flex justify-between items-baseline">
                            <h4 class="text-white">Total Target</h4>
                            <span class="text-2xl font-bold text-white">${d.budget.target_ms}ms</span>
                        </div>
                        <div class="w-full bg-slate-700 rounded-full h-8 mt-4 flex overflow-hidden">
                            ${Object.entries(d.budget.allocation).map(([key, val]) => {
                                const perc = (val / d.budget.target_ms) * 100;
                                return `<div class="flex items-center justify-center text-xs font-medium text-white bg-blue-500/50 hover:bg-blue-500/80 transition" style="width: ${perc}%" title="${key}: ${val}ms">
                                    <span class="hidden md:inline">${key}</span>
                                </div>`;
                            }).join('')}
                        </div>
                        <div class="mt-4">
                            <strong>Degradation Strategy:</strong>
                            <span class="text-slate-400">${d.budget.degrade_strategy.join(', ')}</span>
                        </div>
                    </div>
                `;
            }

            function renderPatternsPage() {
                const d = data.patterns_cookbook;
                return `
                    <h1 class="section-title">Patterns Cookbook</h1>
                    <p class="section-subtitle">Copy-ready briefs for common RAG and Agentic patterns.</p>
                    <div class="mt-12 grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                    ${d.map(p => `
                        <div class="card p-6 flex flex-col">
                            <h3 class="!mt-0">${p.name}</h3>
                            <div class="flex-grow">
                                <p><strong class="text-slate-300">Flow:</strong> ${p.flow}</p>
                                <p><strong class="text-slate-300">Pitfalls:</strong> <span class="text-red-400/80">${p.pitfalls}</span></p>
                            </div>
                        </div>
                    `).join('')}
                    </div>
                `;
            }
            
            function renderTemplatesPage() {
                const d = data.templates_checklists;
                return `
                    <h1 class="section-title">Templates & Checklists</h1>
                    <p class="section-subtitle">Standardized lists to ensure quality and completeness before shipping.</p>
                    
                    <div class="mt-12 space-y-12">
                        <div>
                            <h2>Prompt PR Checklist</h2>
                            <div class="card p-6 mt-4"><ul class="checklist !my-0">${d.prompt_pr.map(i => `<li>${i}</li>`).join('')}</ul></div>
                        </div>
                        <div>
                            <h2>RAG Pipeline Checklist</h2>
                            <div class="card p-6 mt-4"><ul class="checklist !my-0">${d.rag_pipeline.map(i => `<li>${i}</li>`).join('')}</ul></div>
                        </div>
                        <div>
                            <h2>Launch Gate (Go/No-Go)</h2>
                            <div class="card p-6 mt-4"><ul class="checklist !my-0">${d.launch_gate.map(i => `<li>${i}</li>`).join('')}</ul></div>
                        </div>
                    </div>
                `;
            }
            
            function renderGlossaryFaqPage() {
                return `
                    <h1 class="section-title">Glossary & FAQ</h1>
                    <p class="section-subtitle">Shared language and quick answers to common questions.</p>
                    <div class="mt-12 grid grid-cols-1 lg:grid-cols-2 gap-12">
                        <div>
                            <h2>Glossary</h2>
                            <dl class="mt-6 space-y-4">
                                ${Object.entries(data.glossary).map(([term, def]) => `
                                    <div class="card p-4">
                                        <dt class="font-semibold text-white">${term}</dt>
                                        <dd class="mt-1 text-slate-400">${def}</dd>
                                    </div>
                                `).join('')}
                            </dl>
                        </div>
                        <div>
                            <h2>FAQ</h2>
                            <div class="mt-6 space-y-4">
                                ${data.faq.map(item => `
                                    <div class="card p-4">
                                        <h4 class="font-semibold text-white">${item.q}</h4>
                                        <p class="mt-1 text-slate-400">${item.a}</p>
                                    </div>
                                `).join('')}
                            </div>
                        </div>
                    </div>
                `;
            }

            function renderUseCasePage() {
                const d = data.use_case_analyst;
                return `
                    <div class="bg-gradient-to-r from-blue-600 to-purple-600 text-white rounded-xl p-8 mb-12 -mx-8 -mt-8 lg:-mx-12 lg:-mt-12">
                        <h1 class="!text-white !mt-0">Use Case: Multimodal RAG — “Earnings Call Analyst”</h1>
                        <p class="text-blue-200 text-lg leading-relaxed">${d.scenario}</p>
                    </div>

                    <h2>Desired Output & Rules</h2>
                    <div class="card p-6 mt-6">
                        <ul class="checklist">${d.output_rules.map(r => `<li>${r}</li>`).join('')}</ul>
                    </div>
                    
                    <h2 class="mt-12">Complete Prompt Flow</h2>
                    <p>This chain of prompts collaborates to turn a user question into a grounded, multi-source answer.</p>
                    <div class="mt-6 space-y-6">
                        ${d.prompt_flow.map(p => `
                            <div class="card overflow-hidden">
                                <div class="p-6">
                                    <h3 class="!mt-0">${p.title}</h3>
                                    <p class="text-sm text-blue-300"><strong>Goal:</strong> ${p.goal}</p>
                                    <pre class="!text-sm"><code>${p.content}</code></pre>
                                    ${p.example ? `
                                        <div class="mt-4">
                                            <strong class="text-xs text-slate-400 font-mono">EXAMPLE OUTPUT</strong>
                                            <div class="mt-1 p-3 bg-slate-950 rounded-md text-sm text-slate-300 whitespace-pre-wrap font-mono">${p.example}</div>
                                        </div>
                                    ` : ''}
                                </div>
                            </div>
                        `).join('')}
                    </div>

                    <h2 class="mt-12">Flow Diagram</h2>
                    <div class="card mt-6 p-8">${renderDiagram(d.diagram, 'flow')}</div>

                    <h2 class="mt-12">Acceptance Criteria</h2>
                    <p>What "good" looks like for this use case.</p>
                    <div class="card p-6 mt-6">
                        <ul class="checklist">${d.acceptance_criteria.map(r => `<li>${r}</li>`).join('')}</ul>
                    </div>
                `;
            }
            
            function renderDiagram(spec, layout = 'grid') {
                if (layout === 'flow') {
                    return `
                        <div class="flex flex-wrap items-center justify-center gap-x-4 gap-y-2">
                            ${spec.nodes.map((node, i) => `
                                <div class="diagram-node">${node.label}</div>
                                ${i < spec.nodes.length - 1 ? `<div class="diagram-arrow">→</div>` : ''}
                            `).join('')}
                        </div>
                    `;
                }
                // Default grid layout for more complex flows
                const nodeMap = spec.nodes.reduce((acc, node) => ({ ...acc, [node.id]: node.label }), {});
                return `
                    <div class="grid grid-cols-3 gap-x-8 gap-y-6 items-center text-center">
                        <div class="diagram-node">${nodeMap.user}</div>
                        <div class="diagram-arrow">→</div>
                        <div class="diagram-node col-span-2">${nodeMap.prompt}</div>

                        <div></div>
                        <div class="diagram-arrow">↑↓</div>
                        <div></div>

                        <div class="diagram-node">${nodeMap.retrieval}</div>
                        <div class="diagram-arrow">↔</div>
                        <div class="diagram-node">${nodeMap.tools}</div>
                        
                        <div></div>
                        <div class="diagram-arrow">↓</div>
                        <div></div>
                        
                        <div class="diagram-node col-span-3">${nodeMap.guardrails}</div>

                        <div></div>
                        <div class="diagram-arrow">↓</div>
                        <div></div>

                        <div class="diagram-node col-span-3">${nodeMap.answer}</div>

                        <div></div>
                        <div class="diagram-arrow">↑</div>
                        <div></div>

                        <div class="diagram-node col-span-3">${nodeMap.evals}</div>
                    </div>
                `;
            }
            
            window.copyToClipboard = function(button) {
                const content = button.dataset.copyContent;
                const textarea = document.createElement('textarea');
                textarea.value = content;
                document.body.appendChild(textarea);
                textarea.select();
                document.execCommand('copy');
                document.body.removeChild(textarea);
                
                const originalText = button.textContent;
                button.textContent = 'Copied!';
                setTimeout(() => {
                    button.textContent = originalText;
                }, 2000);
            }

            // --- Initialization ---
            navigation.innerHTML = data.sitemap.map(page =>
                `<a href="#${page.id}" class="nav-link block">${page.name}</a>`
            ).join('');

            navigation.addEventListener('click', (e) => {
                if (e.target.tagName === 'A') {
                    e.preventDefault();
                    const pageId = new URL(e.target.href).hash.substring(1);
                    navigate(pageId);
                }
            });
            
            window.addEventListener('hashchange', () => {
                const pageId = window.location.hash.substring(1) || 'home';
                renderPage(pageId);
            });

            const initialPageId = window.location.hash.substring(1) || 'home';
            navigate(initialPageId);
        });
    </script>

</body>
</html>
